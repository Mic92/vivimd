#!/bin/bash

usage() {
  cat <<EOF
usage: ${0##*/} [options] file

  Options:
    -s STYLE       Use STYLE for css.
    -h             Print this help message
    -l             Print available styles.

EOF
}

write_head() {
  cat << EOF
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
EOF
  cat $1
  cat << EOF
</style>
</head>
EOF
}

write_md() {
  markdown $1
}

write_tail() {
  cat << EOF
</html>
EOF
}

if [[ -z $1 ]]; then
  usage
  exit 0
fi

while getopts "s:hl" OPT; do
  case $OPT in 
    s)
      style=${OPTARG^^}
      ;;
    h)
      usage
      exit 0
      ;;
    l)
      ls /usr/share/vivimd/style/*.css
      exit 0
      ;;
    ?)
      exit 1
      ;;
  esac
done
shift $(( OPTIND - 1 ))

(( $style )) || style=/usr/share/vivimd/style/default.css

(( $# )) || echo "No file specified." 1>&2
file=$1; shift

write_head "$style"
write_md "$file"
write_tail
